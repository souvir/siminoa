machine:
  timezone: Europe/Paris
  php:
    version: 7.0.11

  services:
    - mysql

  environment:
      APP_ENV: testing
      APP_KEY: base64:xZxpMuqxVqEMWQPQKERSfb81GLOzreobkoTtbK91TqY=
      DB_CONNECTION: circle
      DB_NAME: circle_test
      DB_USER: ubuntu
      DB_DATABASE: circle_test
      CACHE_DRIVER: array
      SESSION_DRIVER: array
      QUEUE_DRIVER: sync

dependencies:
  override:
    - composer install --prefer-source --no-interaction
    - php artisan migrate

test:
  override:
    - vendor/bin/phpunit --coverage-clover=coverage.xml
  # Upload coverage file to scrutinizer
  post:
    - bash <(curl -s https://codecov.io/bash) -t 890f1a9a-81a0-4466-b31a-2806a749d536
    - wget https://scrutinizer-ci.com/ocular.phar
    - php ocular.phar code-coverage:upload --format=php-clover coverage.xml
